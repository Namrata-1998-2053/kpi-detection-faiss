# Simple FAISS + Embedding KPI Matching Demo
from sentence_transformers import SentenceTransformer
import faiss
import numpy as np

# 1. Load embedding model
model = SentenceTransformer("all-MiniLM-L6-v2")

# 2. Sample KPI baselines (synthetic placeholders)
baselines = [
    "Greet the customer properly",
    "Verify the customer's account",
    "Provide clear step-by-step resolution",
    "Ask if the customer needs further help",
    "Close the chat professionally"
]

# 3. Convert baselines into embeddings
baseline_embeddings = model.encode(baselines)

# 4. Build FAISS HNSW index
dimension = baseline_embeddings.shape[1]
index = faiss.index_factory(dimension, "HNSW32")
index.hnsw.efConstruction = 200
index.add(np.array(baseline_embeddings).astype("float32"))

# 5. Test message
query = "Hello, how may I assist you today?"
query_embedding = model.encode([query])

# 6. Search for closest KPI baseline
D, I = index.search(np.array(query_embedding).astype("float32"), k=1)

print("User message:", query)
print("Matched KPI:", baselines[I[0][0]])

